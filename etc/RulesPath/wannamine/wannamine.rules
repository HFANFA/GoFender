alert tcp $HOME_NET any -> $DC_SERVERS 88 (msg: "[ATTACK] Overpass the hash. Encryption downgrade activity to ARCFOUR-HMAC-MD5"; flow: no_stream, established, to_server; content: "|A1 03 02 01 05 A2 03 02 01 0A|"; offset: 12; depth: 10; content: "|A1 03 02 01 02|"; distance: 5; within: 6; content: "|A0 03 02 01 17|"; distance: 6; within: 6; content: "krbtgt"; distance: 0;  xbits: set, Krb5.AsReq, track ip_src, expire: 10; classtype: attempted-user; reference: url, github.com/ptresearch/AttackDetection; sid: 10002228; rev: 1; )

alert smb any any -> $HOME_NET any (msg: "[ATTACK] Flowbits for SMB NTTrans Request"; flow: established, to_server, no_stream; content: "|FF|SMB|A0|"; flowbits: set, SMB.NTTrans.Req; flowbits: unset, SMB.NTTrans2.Req; flowbits: noalert; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001724; rev: 1; )

alert smb any any -> $HOME_NET any (msg: "[ATTACK] Metasploit MS17-010 ETERNALBLUE Exploitation (CVE-2017-0144)"; flow: established, to_server, no_stream; content: "|FF|SMB|33|"; byte_test: 2, >, 61000, 42, relative, little; flowbits: isset, SMB.NTTrans.Req; flowbits: isnotset, SMB.NTTrans2.Req; reference: cve, 2017-0144; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001726; rev: 1; )

alert tcp any any -> $HOME_NET any (msg: "[ATTACK] Remote WMI Win32_Process create"; flow: established, to_server; content: "|05 00 00|"; depth: 3; content: "W|00|i|00|n|00|3|00|2|00|_|00|P|00|r|00|o|00|c|00|e|00|s|00|s|00 00 00|"; fast_pattern; content: "c|00|r|00|e|00|a|00|t|00|e|00|"; distance: 16; within: 12; nocase; flowbits: set, WMI.Win32_Process.Create; threshold: type limit, track by_src, count 1, seconds 10; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001999; rev: 3; )

alert tcp any any -> $HOME_NET any (msg: "[ATTACK] Suspicious Remote WMI Win32_Process create"; flow: established, to_server; content: "__PARAMETERS|00 00|"; content: "http://"; distance: 0; pcre: "/__PARAMETERS\x00\x00[^\x00]+?(?:cmd|powershell)[^\x00]+?http:\/\//"; flowbits: isset, WMI.Win32_Process.Create; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002000; rev: 2; )

