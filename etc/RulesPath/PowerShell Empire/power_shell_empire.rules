alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "[MALWARE] PowerShell Empire Request HTTP Pattern";flow: established, to_server; content: "POST"; http_method; content: "HTTP/1.1|0d0a|Cookie: session="; depth:1000; fast_pattern; content: "=|0d0a|User-Agent: "; distance:27; within:400; content: "Host: "; within:400; content: "Content-Length: 462|0d0a|"; within: 400; content:!"Referer|3a|"; http_header; content: !"Content-Type: "; http_header; classtype: trojan-activity; metadata: created_at 2017_11_21; reference: url, github.com/ptresearch/AttackDetection; sid: 10002268; rev: 2;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "[MALWARE] PowerShell Empire stager receive over HTTP";flow: established, to_client; content:"200"; http_stat_code; content: "If($PSVersionTable.PSVersion.Major -ge 3){"; http_server_body; nocase; depth: 1000; content: "$GPS=[ref].Assembly.GetType(";http_server_body; nocase; within: 100; content: "System.Management.Automation.Utils";http_server_body; within: 100; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_11_22; reference: url, github.com/ptresearch/AttackDetection; sid: 10002269; rev: 1;)

